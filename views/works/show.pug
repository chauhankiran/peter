extend ../layout 

block content 
    .row.mt-4  
        .col-1 
        .col-11 
            h1 Work details  

            .mt-4 
                include ../includes/flash

    .row.mt-4
        .col-1 
        .col-3
            .mb-4
                strong Project
                p 
                    a(href=`/projects/${work.projectId}`)= work.projectName 
            .mb-4
                strong Title
                p= work.title 

            .mb-4 
                strong Description 
                p.italic.gray= work.description || 'N/A'

        .col-2
            .mb-4
                strong Assignee
                p= work.assigneeName || "Unassigned"
            .mb-4
                strong Status 
                p= work.statusName || 'None'
            .mb-4
                strong Type  
                p= work.typeName || 'None'
            .mb-4
                strong Priority  
                p= work.priorityName || 'None'
            .mb-4
                strong Due date 
                p= work.dueDate || 'N/A'

        .col-5
            .mb-4 
                strong Comments (#{comments.length})
            
            .mb-4 
                form(action=`/projects/${work.projectId}/works/${work.id}/comments`, method="post") 
                    .mb-4 
                        textarea(name="content", rows="10", placeholder="Add a comment...")
                    
                    button(type="submit") Add comment 

            .mb-4 
                if comments.length > 0
                    each comment in comments 
                        .comment-item(data-comment-id=comment.id)
                            p #{comment.creatorName} | #{comment.createdAt} 
                                if comment.createdBy === userId 
                                    a.edit-comment(href="#")  | edit 
                                    a.delete-comment(href="#")  | delete 
                            p.italic= comment.content

                            if comment.createdBy === userId
                                //- Inline edit modal for this comment
                                .modal.edit-comment-modal
                                    .modal-content
                                        .mb-4
                                            h3 Edit comment
                                        form(action=`/projects/${work.projectId}/works/${work.id}/comments/${comment.id}?_method=put`, method="post")
                                            .mb-4
                                                textarea(name="content", rows="10")= comment.content
                                            .text-end.pt-4
                                                button.edit-comment-close.is-muted.mr-4(type="button") Cancel
                                                button(type="submit") Update comment

                                //- Inline delete modal for this comment
                                .modal.delete-comment-modal
                                    .modal-content
                                        .mb-4
                                            h3 Delete comment
                                            p.italic.gray This action cannot be undone.
                                        form(action=`/projects/${work.projectId}/works/${work.id}/comments/${comment.id}?_method=delete`, method="post")
                                            p.mb-4 Are you sure you want to delete this comment?
                                            .text-end.pt-4
                                                button.delete-comment-close.is-muted.mr-4(type="button") Cancel
                                                button.is-danger(type="submit") Yes

                            hr

                else 
                    p.italic.gray No comments found.    
        .col-1

    .row 
        .col-1 
        .col-3 
            button.btn.is-danger.delete-work.mr-2 Delete work 
            a(href=`/projects/${work.projectId}/works/${work.id}/edit`).btn Edit work 
        .col-8 
    include ./delete-work-modal 
