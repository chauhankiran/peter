extend ../layout

block content
    .container-fluid 
        .row
            .col-1.mt-4  
            .col-10.mt-4 
                .d-flex.justify-content-between.align-items-center.mb-4
                    h1 Milestones
                    if permissions && permissions.milestones && permissions.milestones.create
                        a(href=`/projects/${project.id}/milestones/new`).btn New milestone

                include ../includes/flash

                p.mb-4
                    a(href=`/projects/${project.id}`)= project.name
                    span.gray  / Milestones

                if milestones && milestones.length > 0
                    each milestone in milestones
                        .card.mb-3
                            .card-body
                                .d-flex.justify-content-between.align-items-start
                                    div
                                        h3
                                            a(href=`/projects/${project.id}/milestones/${milestone.id}`)= milestone.name
                                        if milestone.description
                                            p.gray= milestone.description
                                        if milestone.dueDate
                                            p.small.gray Due: #{new Date(milestone.dueDate).toLocaleDateString('sv-SE')}
                                    div.text-end
                                        .mb-2
                                            strong #{milestone.progress}%
                                            span.gray.ml-2 (#{milestone.completedWork}/#{milestone.totalWork} work items)
                                        .progress-bar(style="width: 150px; height: 8px; background: #e0e0e0; border-radius: 4px;")
                                            .progress-fill(style=`width: ${milestone.progress}%; height: 100%; background: ${milestone.progress === 100 ? '#28a745' : '#007bff'}; border-radius: 4px;`)
                else
                    p.gray No milestones yet.

                .mb-4.pt-2
                    a(href=`/projects/${project.id}`).btn.is-muted &larr; Back to project

            .col-1.mt-4
